<% container_id = "heart-container-#{SecureRandom.urlsafe_base64(10)}" %>
<% width = 300 %>
<% height = 350 %>
<% image_width = 24 %>
<% heart_offset_y = 100 %>

<svg id="<%= container_id %>" width="<%= width %>" height="<%= height %>" viewBox="0 0 <%= width %> <%= height %>" xmlns="http://www.w3.org/2000/svg">
  <image x="125" y="0" width="50" height="40" xlink:href="<%= image_path('/awards/crown_gold_100x80.gif') %>"/>
  <rect id="close-friends-first-prize" x="138" y="45" width="<%= image_width %>" height="<%= image_width %>" fill="#EA2184"/>

  <image x="50" y="20" width="50" height="40" xlink:href="<%= image_path('/awards/crown_silver_100x80.gif') %>"/>
  <rect id="close-friends-second-prize" x="63" y="65" width="<%= image_width %>" height="<%= image_width %>" fill="#EA2184"/>

  <image x="200" y="20" width="50" height="40" xlink:href="<%= image_path('/awards/crown_bronze_100x80.gif') %>"/>
  <rect id="close-friends-third-prize" x="213" y="65" width="<%= image_width %>" height="<%= image_width %>" fill="#EA2184"/>

  <line x1="42" y1="117" x2="66" y2="117" stroke="#EA2184"></line>
  <line x1="42" y1="117" x2="42" y2="141" stroke="#EA2184"></line>
  <line x1="66" y1="117" x2="90" y2="117" stroke="#EA2184"></line>
  <line x1="90" y1="117" x2="114" y2="117" stroke="#EA2184"></line>
  <line x1="114" y1="117" x2="114" y2="141" stroke="#EA2184"></line>
  <line x1="186" y1="117" x2="210" y2="117" stroke="#EA2184"></line>
  <line x1="186" y1="117" x2="186" y2="141" stroke="#EA2184"></line>
  <line x1="210" y1="117" x2="234" y2="117" stroke="#EA2184"></line>
  <line x1="234" y1="117" x2="258" y2="117" stroke="#EA2184"></line>
  <line x1="258" y1="117" x2="258" y2="141" stroke="#EA2184"></line>
  <line x1="18" y1="141" x2="42" y2="141" stroke="#EA2184"></line>
  <line x1="18" y1="141" x2="18" y2="165" stroke="#EA2184"></line>
  <line x1="114" y1="141" x2="138" y2="141" stroke="#EA2184"></line>
  <line x1="138" y1="141" x2="138" y2="165" stroke="#EA2184"></line>
  <line x1="162" y1="141" x2="186" y2="141" stroke="#EA2184"></line>
  <line x1="162" y1="141" x2="162" y2="165" stroke="#EA2184"></line>
  <line x1="258" y1="141" x2="282" y2="141" stroke="#EA2184"></line>
  <line x1="282" y1="141" x2="282" y2="165" stroke="#EA2184"></line>
  <line x1="18" y1="165" x2="18" y2="189" stroke="#EA2184"></line>
  <line x1="138" y1="165" x2="162" y2="165" stroke="#EA2184"></line>
  <line x1="282" y1="165" x2="282" y2="189" stroke="#EA2184"></line>
  <line x1="18" y1="213" x2="42" y2="213" stroke="#EA2184"></line>
  <line x1="18" y1="189" x2="18" y2="213" stroke="#EA2184"></line>
  <line x1="282" y1="189" x2="282" y2="213" stroke="#EA2184"></line>
  <line x1="258" y1="213" x2="282" y2="213" stroke="#EA2184"></line>
  <line x1="42" y1="237" x2="66" y2="237" stroke="#EA2184"></line>
  <line x1="42" y1="213" x2="42" y2="237" stroke="#EA2184"></line>
  <line x1="258" y1="213" x2="258" y2="237" stroke="#EA2184"></line>
  <line x1="234" y1="237" x2="258" y2="237" stroke="#EA2184"></line>
  <line x1="66" y1="261" x2="90" y2="261" stroke="#EA2184"></line>
  <line x1="66" y1="237" x2="66" y2="261" stroke="#EA2184"></line>
  <line x1="234" y1="237" x2="234" y2="261" stroke="#EA2184"></line>
  <line x1="210" y1="261" x2="234" y2="261" stroke="#EA2184"></line>
  <line x1="90" y1="285" x2="114" y2="285" stroke="#EA2184"></line>
  <line x1="90" y1="261" x2="90" y2="285" stroke="#EA2184"></line>
  <line x1="210" y1="261" x2="210" y2="285" stroke="#EA2184"></line>
  <line x1="186" y1="285" x2="210" y2="285" stroke="#EA2184"></line>
  <line x1="114" y1="309" x2="138" y2="309" stroke="#EA2184"></line>
  <line x1="114" y1="285" x2="114" y2="309" stroke="#EA2184"></line>
  <line x1="186" y1="285" x2="186" y2="309" stroke="#EA2184"></line>
  <line x1="162" y1="309" x2="186" y2="309" stroke="#EA2184"></line>
  <line x1="162" y1="309" x2="162" y2="333" stroke="#EA2184"></line>
  <line x1="138" y1="333" x2="162" y2="333" stroke="#EA2184"></line>
  <line x1="138" y1="309" x2="138" y2="333" stroke="#EA2184"></line>
</svg>

<script>
  $(function () {
    var url = '<%= raw api_v1_close_friends_path(uid: twitter_user.uid, via: current_via) %>';

    $.get(url).done(function (res) {
      new Heart('<%= container_id %>', 0, <%= heart_offset_y %>, <%= width %>, <%= height - heart_offset_y %>, <%= image_width %>, res.users).draw();
    }).fail(function (xhr) {
      console.warn(url, xhr.responseText);
    });
  });
</script>
