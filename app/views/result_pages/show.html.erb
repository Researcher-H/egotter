<% content_for :canonical_url do %>
  <link href="<%= current_canonical_url(@twitter_user) %>" rel="canonical">
<% end %>

<%= content_for :navbar_title, current_navbar_title %>

<% current_breadcrumb(@twitter_user) %>
<% title current_page_title(@twitter_user) %>
<% set_meta_tags description: current_meta_description(@twitter_user) %>

<% if remove_related_page? %>
  <div class="mb-3"><%= render partial: 'twitter_users/bg_polling_js', locals: {twitter_user: @twitter_user} %></div>
<% end %>

<%= render(partial: 'adsense/ad', locals: {vertical: :top}) %>

<%= render partial: 'shared/profile_section', locals: {twitter_user: @twitter_user, expanded: false} %>

<h2 class="h4 text-center my-5"><%= current_content_title(@twitter_user) %></h2>
<div class="mb-5"><%= current_page_description(@twitter_user) %></div>

<% if controller_name == 'close_friends' %>
  <div class="text-center my-3"><%= render partial: 'shared/heart', locals: {twitter_user: @twitter_user} %></div>
<% end %>

<% if remove_related_page? %>
  <%= render(partial: 'twitter/tweet_box', locals: {text: t('unfriends.show.tweet', text: t('modal.welcome_modal.share.tweets').sample, url: unfriends_top_url(via: current_via)), twitter_user: @twitter_user}) %>
<% else %>
  <%= render(partial: 'twitter/tweet_box', locals: {text: current_tweet_text(@twitter_user), twitter_user: @twitter_user}) %>
<% end %>

<%= render(partial: 'adsense/ad', locals: {vertical: :middle}) %>

<% if user_signed_in? && %w(friends followers).include?(controller_name) %>
  <%= render partial: 'shared/word_cloud', locals: {description: profiles_word_cloud_description(@twitter_user), api_path: api_profiles_count_path(@twitter_user)} %>
  <%= render partial: 'shared/word_cloud', locals: {description: locations_word_cloud_description(@twitter_user), api_path: api_locations_count_path(@twitter_user)} %>

  <div><%= tweets_per_hour_description(@twitter_user) %></div>
  <div id="tweets-per-hour-container" class="d-flex align-items-center justify-content-center mt-3 mb-5" style="height: 300px;">
    <div><%= t('.loading_html') %></div>
  </div>
  <script>
    $(function () {
      var url = '<%= api_tweet_times_path %>';
      var uid = '<%= @twitter_user.uid %>';
      var container = $('#tweets-per-hour-container');

      $.get(url, {uid: uid}).done(function (res) {
        container.empty();
        new UsageStat().drawColumnChart(container.attr('id'), res.tweets_per_hour);
      }).fail(function (xhr) {
        console.warn(url, xhr.responseText);
        container.empty().text('<%= t('.updating') %>');
      });
    });
  </script>
<% end %>

<div class="mb-3"><%= render partial: 'result_pages/tabs', locals: {tabs: current_tabs(@twitter_user), active_tab: @active_tab} %></div>

<% if (tab = current_tabs(@twitter_user)[@active_tab]) && tab.count && tab.count >= 1 %>
  <% if remove_related_page? %>
    <div class="card mb-3">
      <div class="card-body small">
        <%= t('.explanation_of_data_inconsistency_html') %>
      </div>
    </div>

  <% end %>

  <div class="text-right mb-4">
    <%= render partial: 'shared/sort' %>
    <%= render partial: 'shared/filter' %>
    <%= render partial: 'shared/download' %>
  </div>

  <%= render partial: 'shared/users_section', locals: {twitter_user: @twitter_user} %>
<% else %>
  <div class="alert alert-info small">
    <%= t('.reason_for_zero_html') %>
  </div>
<% end %>

<%= render(partial: 'adsense/ad', locals: {vertical: :bottom}) %>
