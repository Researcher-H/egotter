<div class="kpis dau"><%= image_tag '/ajax-loader.gif' %></div>
<div><%= link_to('DAU', kpis_dau_path) %></div>

<div class="kpis search_num"><%= image_tag '/ajax-loader.gif' %></div>
<div><%= link_to('Search num', kpis_search_num_path) %></div>

<div class="kpis new_user"><%= image_tag '/ajax-loader.gif' %></div>
<div><%= link_to('New user', kpis_new_user_path) %></div>

<div class="kpis sign_in"><%= image_tag '/ajax-loader.gif' %></div>
<div><%= link_to('Sign in', kpis_sign_in_path) %></div>

<br>
<div><%= link_to('RR', kpis_rr_path) %></div>

<br>
<div><%= link_to('Table', kpis_table_path) %></div>

<script>
  var config = window.kpis.config;
  var config_stacked = window.kpis.config_stacked;

  function fetch_dau(url){
    $.get(url).done(function(res){
      draw_dau(res.dau, 'DAU (search_logs)', '.dau');
    }).fail(function (xhr) {
      console.log(xhr.responseText)
    });
  }

  function draw_dau(series, title, selector){
    var conf = $.extend(true, {}, config);
    conf.title.text = title;
    conf.series = series;
    $(selector).empty().highcharts(conf);
  }

  function fetch_search_num(url){
    $.get(url).done(function(res){
      draw_search_num(res.search_num, 'Search num (search_logs)', '.search_num');
    }).fail(function (xhr) {
      console.log(xhr.responseText)
    });
  }

  function draw_search_num(series, title, selector){
    var conf = $.extend(true, {}, config_stacked);
    conf.title.text = title;
    conf.series = series;
    $(selector).empty().highcharts(conf);
  }

  function fetch_new_user(url){
    $.get(url).done(function(res){
      draw_new_user(res.new_user, 'New user (users)', '.new_user');
    }).fail(function (xhr) {
      console.log(xhr.responseText)
    });
  }

  function draw_new_user(series, title, selector){
    var conf = $.extend(true, {}, config);
    conf.title.text = title;
    conf.series = series;
    $(selector).empty().highcharts(conf);
  }

  function fetch_sign_in(url){
    $.get(url).done(function(res){
      draw_sign_in(res.sign_in, 'Sign in (sign_in_logs)', '.sign_in');
    }).fail(function (xhr) {
      console.log(xhr.responseText)
    });
  }

  function draw_sign_in(series, title, selector){
    var conf = $.extend(true, {}, config);
    conf.title.text = title;
    conf.series = series;
    $(selector).empty().highcharts(conf);
  }

  $(function () {
    fetch_dau("<%= kpis_dau_path %>");
    fetch_search_num("<%= kpis_search_num_path %>");
    fetch_new_user("<%= kpis_new_user_path %>");
    fetch_sign_in("<%= kpis_sign_in_path %>");
  });
</script>
