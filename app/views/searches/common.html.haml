- title @title
- set_meta_tags description: "#{@title} - #{@searched_tw_user.description}"

= render(partial: 'profiles/overview',
  locals: {user: @searched_tw_user, unique_id: @searched_tw_user.uid})

:javascript
  $(function () {
    enableSlickOnPageTop('#{@searched_tw_user.uid}');
  });

.common-result
  %h2.h4= @title

  .return-to-results-top= link_to(t('searches.common.return', user: @searched_tw_user.mention_name), search_path(screen_name: @searched_tw_user.screen_name))

  = render(partial: 'common/adsense')

  .loading-image.text-center
    = t('searches.waiting.analyzing', user: @searched_tw_user.name)
    = image_tag '/ajax-loader.gif'

  .error-msg.text-center{style: 'display: none; margin-bottom: 15px;'}

  :javascript
    'use strict';
    $(function () {
      const url = "#{send("#{@menu}_results_path", id: @searched_tw_user.uid, page: params[:page])}";
      const retryTimeout = '#{t('before_sign_in.retry_timeout', sign_in_link: link_to(t('dictionary.sign_in'), welcome_path)).html_safe}';
      const somethingIsWrong = '#{t('before_sign_in.something_is_wrong', sign_in_link: link_to(t('dictionary.sign_in'), welcome_path)).html_safe}';

      $.get(url)
          .done((res) => {
            $('.common-result').append(res.html);
            var path = window.location.pathname + window.location.search + '#loaded';
            window.history.replaceState(null, null, path)
          })
          .fail((xhr) => {
            if (xhr.status === 502) {
              Rollbar
                .scope({action: "#{action_name}", uid: #{@searched_tw_user.uid}})
                .warning("Timeout while attempting fetching.");
              $('.error-msg').append(retryTimeout).show();
            } else {
              $('.error-msg').append(somethingIsWrong).show();
            }
            console.log(xhr.responseText);
          })
          .always(() => $('.loading-image').remove());
    });
