<div class="settings">
  <h2 class="h4 text-center"><%= t('.general_title') %></h2>

  <table class="table">
    <tbody>
    <tr>
      <td><%= User.human_attribute_name(:screen_name) %></td>
      <td>
        <span>@</span><span class="screen-name"><%= current_user.screen_name %></span>
      </td>
    </tr>
    <tr>
      <td><%= User.human_attribute_name(:email) %></td>
      <td><%= current_user.email %></td>
    </tr>
    <tr>
      <td><%= User.human_attribute_name(:authorized) %></td>
      <td>
        <% if current_user.authorized? %>
          <%= t('.authorized.true') %>
          <div class="text-muted notes"><%= t('.authorized.note1', count: search_histories_limit) %></div>
        <% else %>
          <div>
            <span><%= t('.authorized.false') %></span>
            <%= link_to t('.update_authorized'), sign_in_path(via: build_via('update_authorized'), redirect_path: settings_path), class: 'btn btn-primary btn-xs' %>
          </div>
          <div class="text-muted notes"><%= t('.authorized.note2') %></div>
        <% end %>
      </td>
    </tr>
    <tr>
      <td><%= User.human_attribute_name(:following_egotter) %></td>
      <td>
        <% if current_user.following_egotter? %>
          <%= t('.following_egotter.true') %>
          <div class="text-muted notes"><%= t('.following_egotter.note1') %></div>
        <% else %>
          <div>
            <span><%= t('.following_egotter.false') %></span>
            <%= link_to t('.update_following'), '#', data: {url: follow_path, uid: User::EGOTTER_UID}, class: 'update-following btn btn-primary btn-xs' %>
          </div>
          <div class="text-muted notes"><%= t('.following_egotter.note2') %></div>
        <% end %>
      </td>
    </tr>
    <tr>
      <td><%= User.human_attribute_name(:sharing_egotter) %></td>
      <td>
        <% if current_user.sharing_egotter? %>
          <%= t('.sharing_egotter.true') %>
          <div class="text-muted notes"><%= t('.sharing_egotter.note1', count: search_histories_sharing_bonus) %></div>
      <% else %>
          <div>
            <span><%= t('.sharing_egotter.false') %></span>
            <a href="#" data-target="#share-modal" data-toggle="modal" class="btn btn-primary btn-xs"><%= t('.update_sharing') %></a>
          </div>
          <div class="text-muted notes"><%= t('.sharing_egotter.note2') %></div>
        <% end %>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="vertical-spacing"></div>

  <h2 class="h4 text-center"><%= t('.reset_menu.title') %></h2>

  <table class="table">
    <tbody>
    <tr>
      <td><%= t('.reset_menu.profile') %></td>
      <td>
        <%= link_to t('.reset_menu.update_profile'), sign_in_path(via: build_via('update_profile'), redirect_path: settings_path), class: 'btn btn-default' %>
        <div class="text-muted notes"><%= t('.reset_menu.update_profile_note') %></div>
      </td>
    </tr>
    <tr>
      <td><%= t('.reset_cache.title') %></td>
      <td>
        <% if @reset_cache_request %>
          <div class="btn btn-warning reset-cache-btn" disabled="disabled"><%= t('.reset_cache.reset') %></div>
          <div class="text-muted notes"><%= t('.reset_cache.requested') %></div>
        <% else %>
          <div class="btn btn-warning reset-cache-btn" data-toggle="modal" data-target="#reset-cache-modal"><%= t('.reset_cache.reset') %></div>
        <% end %>
      </td>
    </tr>
    <tr>
      <td><%= t('.reset_egotter.title') %></td>
      <td>
        <% if @reset_egotter_request %>
          <div class="btn btn-danger reset-egotter-btn" disabled="disabled"><%= t('.reset_egotter.reset') %></div>
          <div class="text-muted notes"><%= t('.reset_egotter.requested') %></div>
        <% else %>
          <div class="btn btn-danger reset-egotter-btn" data-toggle="modal" data-target="#reset-egotter-modal"><%= t('.reset_egotter.reset') %></div>
        <% end %>
        <div class="text-danger notes"><%= t('.reset_egotter.danger') %></div>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="vertical-spacing"></div>

  <h2 class="h4 text-center"><%= t('.update_histories.title') %></h2>

  <table class="table">
    <tbody>
    <tr>
      <td><%= t('.update_histories.size') %></td>
      <td><%= @update_histories.size %></td>
    </tr>
    <tr>
      <td><%= t('.update_histories.created_at') %></td>
      <td><%= @update_histories.created_at %></td>
    </tr>
    <tr>
      <td><%= t('.update_histories.updated_at') %></td>
      <td><%= @update_histories.updated_at %></td>
    </tr>
    </tbody>
  </table>

  <div class="vertical-spacing"></div>

  <h2 class="h4 text-center"><%= t('.order.order_histories') %></h2>

  <% if current_user.is_subscribing? %>
    <table class="table">
      <tbody>
      <% current_user.orders.unexpired.each.with_index do |order, i| %>
        <tr>
          <td><%= t('.order.id', id: i + 1) %></td>
          <td>
            <div><%= t('.order.expired_at', date: order.end_date) %></div>
            <div><%= t('.order.search_count', count: order.search_count) %></div>
            <div><%= t('.order.follow_requests_count', count: order.follow_requests_count) %></div>
            <div><%= t('.order.unfollow_requests_count', count: order.unfollow_requests_count) %></div>
          </td>
        </tr>
      <% end %>
      <tr>
        <td></td>
        <td><%= link_to t('.order.plans'), pricing_path %></td>
      </tr>
      </tbody>
    </table>
  <% else %>
    <table class="table">
      <tbody>
        <tr>
          <td><%= t('.order.has_not_purchased') %></td>
          <td><%= link_to t('.order.plans'), pricing_path %></td>
        </tr>
      </tbody>
    </table>
  <% end %>

  <div class="vertical-spacing"></div>

  <h2 class="h4 text-center"><%= t('.trial_title') %></h2>

  <table class="table trial">
    <tbody>
    <tr>
      <td><%= t('.delete_tweets.title') %></td>
      <td>
        <a href="<%= delete_tweets_top_path %>"><%= t('delete_tweets.new.simple_title') %></a><%= t('.delete_tweets.move_to') %>
      </td>
    </tr>
    <tr>
      <td><%= t('.trial_follow_request') %></td>
      <td>
        <a class="btn btn-default" href="<%= settings_follow_requests_path %>"><%= t('.trial_follow_request_see') %></a>
        <div class="text-muted notes"><%= t('.trial_follow_request_note') %></div>
      </td>
    </tr>
    <tr>
      <td><%= t('.trial_unfollow_request') %></td>
      <td>
        <a class="btn btn-default" href="<%= settings_unfollow_requests_path %>"><%= t('.trial_unfollow_request_see') %></a>
        <div class="text-muted notes"><%= t('.trial_unfollow_request_note') %></div>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="vertical-spacing"></div>

  <h2 class="h4 text-center"><%= t('.notifications_title') %></h2>
  <div class="tgl-btns-wrapper">
    <%= render partial: 'tgl_btn', collection: %i(email dm news search), as: :name %>
  </div>

  <table class="table trial">
    <tbody>
    <tr>
      <td><%= t('.prompt_report.title') %></td>
      <td>
        <a class="btn btn-default" href="<%= settings_create_prompt_requests_path %>"><%= t('.prompt_report.see') %></a>
        <div class="text-muted notes"><%= t('.prompt_report.note') %></div>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<div class="modal fade" id="reset-egotter-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"><%= t('.reset_egotter.title') %></h4>
      </div>
      <div class="modal-body">
        <p><%= t('.reset_egotter.warning_html', screen_name: current_user.screen_name) %></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= t('.reset_egotter.cancel') %></button>
        <button type="button" class="btn btn-danger ok" data-url="<%= reset_egotter_path %>"><%= t('.reset_egotter.ok') %></button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="reset-cache-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"><%= t('.reset_cache.title') %></h4>
      </div>
      <div class="modal-body">
        <p><%= t('.reset_cache.warning_html') %></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal"><%= t('.reset_cache.cancel') %></button>
        <button type="button" class="btn btn-warning ok" data-url="<%= reset_cache_path %>"><%= t('.reset_cache.ok') %></button>
      </div>
    </div>
  </div>
</div>

<script>
  $(function () {
    $('.update-following').on('click', function () {
      var $clicked = $(this);
      Twitter.follow($clicked.data('url'), $clicked.data('uid'));
      return false;
    });

    Settings.enableResetEgotterButton();

    Settings.enableResetCacheButton();

    var url = '<%= setting_path %>';
    attach_event_handler('email', url);
    attach_event_handler('dm', url);
    attach_event_handler('news', url);
    attach_event_handler('search', url);
  });
</script>
