# /etc/init.d/unicorn

. /etc/init.d/functions

if echo ' \c' | grep 'c' > /dev/null 2>&1; then
  en='-n'
  ec=''
else
  en=''
  ec='\c'
fi

NAME=unicorn
APP_ROOT="/home/ec2-user/egotter"

start() {
  cd $APP_ROOT
  sudo -u ec2-user -H bash -l -c "cd $APP_ROOT && bundle exec rake unicorn:start RAILS_ENV=production"
  echo ${en} "Starting $NAME: ${ec}"
  success
  echo
}

stop() {
  cd $APP_ROOT
  sudo -u ec2-user -H bash -l -c "cd $APP_ROOT && bundle exec rake unicorn:stop RAILS_ENV=production"
  RETVAL=$?

  echo ${en} "Stopping $NAME: ${ec}"
  success
  echo
  return $RETVAL
}

status() {
  ps -ef | grep 'unicorn_rails' | grep -v grep
  return $?
}


case "$1" in
  start)
          start
          ;;
  stop)
          stop
          ;;
  restart)
          stop
          sleep 1
          start
          ;;
  status)
          status

          if [ $? -eq 0 ]; then
               echo "unicorn is running .."
               RETVAL=0
           else
               echo "unicorn is stopped .."
               RETVAL=1
           fi
          ;;
  *)
          echo "Usage: unicorn {start|stop|restart|status}" >&2
          exit 1
          ;;
esac
exit 0

